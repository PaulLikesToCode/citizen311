<!DOCTYPE html>
<html>
<head>
    <title>Welcome to citizen311</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    {% load staticfiles %}
    <link href="{% static "css/bootstrap.css" %}" rel="stylesheet" media="screen">
    <link href="{% static "css/main.css" %}" rel="stylesheet" media="screen">
    <link rel="stylesheet" href= "{% static "css/whhg.css" %}">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]> <script src="../../assets/js/html5shiv.js"></script> <script src="../../assets/js/respond.min.js"></script> <![endif]-->
</head>
<body onload="initialize()">

    <!--map-->
    <div id="map_canvas" class="map"></div>
    <!--/map-->

        <!--Content-->
        <div class="col-md-11 side-bar" id="cont">
             <!--Map open (for adaptive)-->
            <div class="row map_open">
                <div class="col-md-12">
                    <a href="#" id="map_open">Show map</a>
                </div>
            </div>
              <!--/Map open (for adaptive)-->
            <!--Category menu-->
            <div class="row">
                <div class="logo">
                    <a href="/"><h1>citizen311</h1></a>
                </div>
                <div class="col-md-12">
                    <div id="tabs">
                        <div id="tab1" class="active tab">
                            <h5 class="cat">Narrow down your search.</h5>
                            <ul class="catalog">
                                <li>
                                    <label class="checkboxes" for="cleaning">Street and Sidewalk Cleaning</label>
                                    <input type="checkbox" name="Street and Sidewalk Cleaning" id="cleaning" value="cleaning">
                                </li>
                                <li>
                                    <label class="checkboxes" for="graffiti">Graffiti</label>
                                    <input type="checkbox" name="Graffiti Private Property" id="graffiti" value="graffiti">
                                </li>
                                <li>
                                    <label class="checkboxes" for="litter">Litter Receptacles</label>
                                    <input type="checkbox" name="Litter Receptacles" id="litter" value="litter">
                                </li>
                                <li>
                                    <label class="checkboxes" for="tree">Tree Maintenance</label>
                                    <input type="checkbox" name="Tree Maintenance" id="tree" value="tree">
                                </li>
                                <li>
                                    <label class="checkboxes" for="streetlights">Streetlights</label>
                                    <input type="checkbox" name="Streetlights" id="streetlights" value="streetlights">
                                </li>
                                <li>
                                    <label class="checkboxes" for="sewer">Sewer Issues</label>
                                    <input type="checkbox" name="Sewer Issues" id="sewer" value="sewer">
                                </li>
                                <li>
                                    <label class="checkboxes" for="sign">Sign Repair</label>
                                    <input type="checkbox" name="Sign Repair" id="sign" value="sign">
                                </li>
                                <li>
                                    <label class="checkboxes" for="street">Street Defects</label>
                                    <input type="checkbox" name="Street Defects" id="street" value="street">
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!--/Category menu-->
            <!--Search-->
            <div class="row search_inner_box">
                <div class="col-md-12">
                    {% if user.is_authenticated %}
                    <span style="color:orange">Don't see it? Report it.</span>
                    <br/>
                    <a href="submit" class="btn btn-danger btn-sm pd-top">Report</a>
                    <br/>
                    <a href="logout" class="btn btn-danger btn-sm pd-top">Log out</a>
                    {% else %}
                    <span style="color:orange">Don't see it? Sign in or sign up to report it.</span>
                    <br/>
                    <a id="signInButton" href="signup" class="btn btn-primary btn-sm pd-top">Sign up or log in</a>
                    {% endif %}
                </div>
            </div>
            <!--/search-->
        </div>
        <!--/Content-->
    </div>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="{% static "js/jQueryv2.0.3.js" %}"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="{% static "js/bootstrap.js" %}"></script>
    <!--Google maps API linl-->
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyB31mjMaXNA33VUKwCndXANCkbgULTyY2k&sensor=false"></script>
    <!--Your map settings script-->
    <script>
        var markersJson = {{ json|safe }};
        var markersObject = {};
{#        var latitude;#}
{#        var longitude;#}
{#        var address;#}
{#        var id;#}
{#        var case_id;#}
{#        var comments;#}
        var category;
{#        var customInfo;#}
{#        var map;#}
        var markersSelected = [];
        var markersData = [];
        var categoryList = [];
        var curCategory = '';
        var markerObj = {};
// Trying out new way to draw the map and markers:
        function getDynamicMap() {
            var center = new google.maps.LatLng(37.766396,-122.452927);
            var mapOptions = {
                zoom: 13,
                center: center,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                panControl: false,
                mapTypeControlOptions: {
                    position: google.maps.ControlPosition.TOP_RIGHT
                },
                zoomControl: true,
                zoomControlOptions: {
                    style: google.maps.ZoomControlStyle.LARGE,
                    position: google.maps.ControlPosition.TOP_RIGHT
                    }
            };
            map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
            buildMarkers(markersJson);
        }

        function buildMarkers(markersData) {
            for (var i in markersData) {
                // CHECK IF CATEGORY IS IN MASTER CATEGORY LIST
                var category = markersData[i].fields.category;
                if ($.inArray(category,categoryList)===-1) {
                    categoryList.push(category);
                    markersObject[category] = [];
                }
                // THIS MARKER OBJECT
                var markerObj = {
                    id: markersData[i].pk
                }
                // COPY MARKER DATA FROM SERIALIZED JSON FIELDS
                for (var j in markersData[i].fields) {
                    markerObj[j] = markersData[i].fields[j];
                }
                // ADDITIONAL MARKER SETUP

                markerObj.customInfo = '<a href="/lookup/'+markerObj.id+'">'+markerObj.category+'</a>';
                markerObj.infoWindow = new google.maps.InfoWindow({
                    content: markerObj.customInfo
                });
                markerObj.marker = new google.maps.Marker({
                    position: new google.maps.LatLng(markerObj.latitude,markerObj.longitude),
                    map: map,
                    title: markerObj.customInfo,
                    category: markerObj.category
                   });
                google.maps.event.addListener(markerObj.marker, 'click', function() {
                    console.log(this.title);
                    markerObj.infoWindow.setContent(this.title);
                    markerObj.infoWindow.open(map,this);
                });
                markersObject[category].push(markerObj);
            }
            console.log(categoryList);
            console.log(markersObject);
            console.log(markersObject["Tree Maintenance"][3]);

        }
/*
        function setMarkers(map) {
            for (var i = 0; i < markersArray.length; i++) {
                markersArray[i].setMap(map);
            }
        }

        function clearOverlays() {
            setMarkers(null);
        }
*/

        function updateCategoryMarker(category,visibleFlag) {
            console.log(category + ' ' + visibleFlag);
            for(i in markersObject[category]) {
                markersObject[category][i].marker.setVisible(visibleFlag);
            }
        }

        $(document).ready(function() {
            $(".catalog input[type=checkbox]").on('click',function() {
                category = $(this).attr("name")
                console.log(category);
                for(i in categoryList) {
                    if (categoryList[i] === category) {
                        updateCategoryMarker(categoryList[i],true);
                    } else {
                        updateCategoryMarker(categoryList[i],false);
                    }
                }
                /*
                for (i in markersObject[cat]) {
                    console.log('for');

                    if (markersObject[i].marker.category === cat) {
                        console.log('if');
                        markerObj.marker.setVisible(true);
                    }
                    else {
                        console.log('else');
                        markersObject[category][i].setVisible(false);
                    }
                }
                */
            });
        });

        google.maps.event.addDomListener(window, 'load', getDynamicMap);


//Old way to do the map and markers.
/*        function getDynamicMap(position) {
            var mapOptions = {
                center: new google.maps.LatLng(37.797677,-122.394339),
                zoom: 14,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            }
            map = new google.maps.Map(document.getElementById('map_canvas'), mapOptions);
            for (var i in markersJson) {
                var lat = markersJson[i].fields.latitude;
                var lng = markersJson[i].fields.longitude;
                var address = markersJson[i].fields.address;
                var case_id = markersJson[i].fields.case_id;
                var category = markersJson[i].fields.category;
                var id = markersJson[i].pk;
                var comment = markersJson[i].fields.comments;
                var customInfo = '<a href="/lookup/'+id+'">'+category+'</a>';
                //var customInfo = '<a href="http://bootcamp.rocketu.com/exercises/project/reports-page.html$'+complaints[id].case_id+'">'+complaints[id].case_id+'</a>';
                var infoWindow = new google.maps.InfoWindow({
                    content: customInfo
                });
                var	marker = new google.maps.Marker({
                    position: new google.maps.LatLng(lat,lng),
                    map: map,
                    title: customInfo
                   });
                markersArray.push(marker);
                marker.setMap(map);
                google.maps.event.addListener(marker, 'click', function() {
                    console.log(this.title);
                    infoWindow.setContent(this.title);
                    infoWindow.open(map,this);
                });
            }
            markersArray.setMap(map);
        }

        function selectCategory() {
            $("li").on('click',function() {
                if (markersArray && markers.length) {
                    console.log('hide');
                    for (var i = 0; i < markersArray.length;, i++) {
                        markersArray[i].setMap(null);
                    }
                }
            });
        }

        google.maps.event.addDomListener(window, 'load', getDynamicMap);

        function fillCommentsBox(pk) {
            localStorage.id = pk + 1;
            localStorage.address = address;
            localStorage.category = category;
            localStorage.opened = markers[pk].fields.opened;
            localStorage.lat = lat;
            localStorage.lng = lng;
            $('#opened').html(markers[pk].fields.opened);
            $('#status').html(markers[pk].fields.status);
            $('#category').html(markers[pk].fields.category);
            $('#address').html(markers[pk].fields.address);
        }
*/
    </script>
    <script type="text/javascript" src="{% static "js/map.js" %}"></script>
    <!--jQuery-->
        <script type="text/javascript" src="{% static "js/jQueryv2.0.3.js" %}"></script>
    <script type="text/javascript" src="{% static "js/pxgradient-1.0.2.jquery.js" %}"></script>
    <!--Script for worked left smile categoryes menu-->
    <script type="text/javascript">
        $(document).ready(function () {
                        "use strict";
            $(".inner ul li a").each(function (i) {
                $(".inner ul li a:eq(" + i + ")").click(function () {
                    var tab_id = i + 1;
                    $(".inner ul li a").removeClass("active");
                    $("#tabs .active").removeClass("active");
                    $(this).addClass("active");
                    $("#tabs div").stop(false, false).hide();
                    $("#tab" + tab_id).stop(false, false).show();
                    return false;
                })
            })
        })
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
                        "use strict";
            $("#tabs_point li a").each(function (i) {
                $("#tabs_point li a:eq(" + i + ")").click(function () {
                    var tab_id = i + 1;
                    $("#tabs_point li a").removeClass("active");
                    $(".tabs_block_point .active").removeClass("active");
                    $(this).addClass("active");
                    $(".tabs_block_point div").stop(false, false).hide();
                    $("#point_tab" + tab_id).stop(false, false).show();
                    return false;
                })
            })
        })
    </script>
    <!--/Script for worked left smile categoryes menu-->
    <!--Script for worked profile page-->
    <script type="text/javascript">
        $(document).ready(function () {
                        "use strict";
            $('#link_open').on('click', function () {
                if ($('#link_open').hasClass("clooses")) {
                    $("#open_span").removeClass("close_span").addClass("open_span");
                    $("#profile").removeClass("profile_closed");
                    $("#link_open").removeClass("clooses");
                    $("#cont").addClass("none");
                }
                else {
                    $("#open_span").addClass("close_span").removeClass("open_span");
                    $("#profile").addClass("profile_closed");
                    $("#link_open").addClass("clooses");
                    $("#cont").removeClass("none");
                }
            })
              $('#map_open').on('click', function () {
                            "use strict";
            $("#cont").addClass("none");
            $("#Show_cont").removeClass("none");

        })
        $('#Show_cont').on('click', function () {
                        "use strict";
            $("#cont").removeClass("none");
        })
        });
    </script>
    <!--/Script for worked profile page-->
    <!--Script for gradient icon in general menu-->
    <script type="text/javascript">
        $(function () {
                        "use strict";
            $(".gradientmenu").pxgradient({
                step: 10,
                colors: ["#fdfeff", "#cfeefa"],
                dir: "y"
            });
        });
    </script>
</body>
</html>